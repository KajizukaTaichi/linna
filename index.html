<!doctype html>
<html lang="en">
    <head>
        <title>Linna: code editor that doesn't make you anger</title>
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.3/css/bulma.min.css"
        />
    </head>

    <body>
        <p class="title">Linna: code editor that doesn't make you anger</><br>
        <button onclick="navigator.clipboard.writeText(buffer)" class="button">
            Copy
        </button>
        <hr>
        <div id="editor"></div>
    </body>

    <script>
        let buffer = "";
        let cursor = 0;

        function insertString(originalString, index, stringToInsert) {
            return (
                originalString.slice(0, index) +
                stringToInsert +
                originalString.slice(index)
            );
        }

        function removeCharAtIndex(str, index) {
            return str.slice(0, index) + str.slice(index + 1);
        }

        document.addEventListener("DOMContentLoaded", function () {
            document.addEventListener("keydown", function (event) {
                event.preventDefault();
                console.log(event.code);
                if (event.code === "ArrowLeft") {
                    cursor -= 1;
                } else if (event.code === "ArrowRight") {
                    cursor += 1;
                } else if (event.code === "ArrowUp") {
                    cursor -= 15;
                } else if (event.code === "ArrowDown") {
                    cursor += 15;
                } else if (event.code === "Backspace") {
                    if (cursor != 0) {
                        buffer = removeCharAtIndex(buffer, cursor - 1);
                        cursor -= 1;
                    }
                } else if (event.code === "Enter") {
                    buffer = insertString(buffer, cursor, "\n");
                    cursor += 1;
                } else if (event.code === "Tab") {
                    buffer = insertString(buffer, cursor, "    ");
                    cursor += 4;
                } else if (
                    event.code === "ShiftLeft" ||
                    event.code === "ShiftRight" ||
                    event.code === "MetaLeft" ||
                    event.code === "MetaRight" ||
                    event.code === "ControlLeft" ||
                    event.code === "ControlRight" ||
                    event.code === "Escape"
                ) {
                } else {
                    if (event.shiftKey) {
                        buffer = insertString(
                            buffer,
                            cursor,
                            event.key.toUpperCase(),
                        );
                    } else {
                        buffer = insertString(buffer, cursor, event.key);
                    }
                    cursor += 1;
                }

                if (cursor > buffer.length) {
                    cursor = buffer.length;
                }
                if (cursor < 0) {
                    cursor = 0;
                }

                let show = insertString(
                    buffer,
                    cursor,
                    "<span id='cursor'>&#124;</span>",
                );
                let editor = document.getElementById("editor");
                editor.textContent = "";

                for (line of show.split("\n")) {
                    let elm = document.createElement("pre");
                    elm.className = "line";
                    elm.innerHTML = (line == "") ? " " : line;
                    editor.appendChild(elm);
                }
            });
        });
    </script>

    <style>
        body {
            padding: 1vh;
            font-family: monospace;
            background-color: whitesmoke;
            color: black;
        }

        #cursor {
            color: red;
        }

        .line {
            padding: 0;
            background-color: white;
            border-bottom: 1px solid whitesmoke;
        }

        #editor {
            background-color: white;
            color: black;
            height: 80vh;
        }
    </style>
</html>
